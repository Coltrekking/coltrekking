<!DOCTYPE html>
<html>
	<head>
		<title>LoggedIn</title>
		<script src="https://www.gstatic.com/firebasejs/3.7.1/firebase.js"></script>
		<script src="https://apis.google.com/js/platform.js" async defer></script>

		<script type="text/javascript">
			var provider = new firebase.auth.GoogleAuthProvider();
			var userLogado;
			var url;
			var xmlhttp = new XMLHttpRequest();
			// Initialize Firebase
			var config = {
				apiKey: "AIzaSyDWuZXZioUNujSBLLOtH1tRF8IWCIqMH4g",
				authDomain: "coltrekking-b81da.firebaseapp.com",
				databaseURL: "https://coltrekking-b81da.firebaseio.com",
				storageBucket: "coltrekking-b81da.appspot.com",
				messagingSenderId: "1020694218506"
			};
			firebase.initializeApp(config);

			/***Pega info do user logado***/
			window.onload = function(){
				//Monta Ranking
				ranking();
			}
			
			//Pega info do usuario logado
			function login() {
				url = '/login'; //URL da solicitacao
				xmlhttp.onreadystatechange = function(){
					if(xmlhttp.readyState == 4 && xmlhttp.status == 200){
						userLogado = JSON.parse(xmlhttp.responseText);
						console.log(userLogado);
						mostraInfo();
					}
				};
				xmlhttp.open("POST", url, true);
				xmlhttp.send();
			}

			/***Mostra dados do usuario***/
			function mostraInfo() {
				console.log(userLogado);
				//Mostra imagem
				document.getElementById('userImage').src = userLogado.Foto;
				document.getElementById('userImage').style.width = "50px";
				document.getElementById('userImage').style.height = "50px";
				//Mostra mensagem de boas vindas
				document.getElementById('welcomeMessage').innerHTML = "Bem Vindo " + userLogado.Nome;
				//Mostra fator k
				document.getElementById('fatork').innerHTML = "Fator K: " + userLogado.FatorK;
				//Mostra posicao
				document.getElementById('posicao').innerHTML = "Posição no Ranking: " + userLogado.Posicao;
				//Mostra estado lista negra
				document.getElementById('listaNegra').innerHTML = "Estado na Lista Negra: " + userLogado.ListaNegra;
			}

			/***Ranking***/
			function ranking() {
				console.log("VOU MONTAR RANKING");
				//Monta o ranking
				url = '/ranking'; //URL da solicitacao
				xmlhttp.onreadystatechange = function(){
					if(xmlhttp.readyState == 4 && xmlhttp.status == 200){
						console.log("Ranking bem-sucedido");
						login();
					}
				};
				xmlhttp.open("GET", url, true);
				xmlhttp.send();
			}
			
			/***Sign Out***/
			function signOut() {
				firebase.auth().signOut().then(function() {
					//SignOut bem-sucedido
					userInfo = null;
					user = null;
					console.log("Volte sempre!");
				}, function(error) {
					//Deu ruim
				});
			}

		</script>
	</head>
	
	<body>
		<h1>Usuario logado com sucesso</h1>

		<!--Info do usuario-->
		<div>
			<img id="userImage" height="0px" width="0px" style="display: inline-block; border-radius: 100%; vertical-align: middle;" hidden="true">
			<h2 id="welcomeMessage" style="display: inline-block;" hidden="true"></h2>
			<h3 id="fatork"></h3>
			<h3 id="posicao"></h3>
			<h3 id="listaNegra"></h3>
		</div>

		<!--Mostrar ranking button-->
		<input type="button" name="ranking" value="Ranking" onclick="ranking();">
		<br>
		<br>

		<!--Sign out button-->
		<form action="/signout" method="get">
			<input type="submit" value="SignOut" name="signout" onclick="signOut();">
		</form>
	</body>
</html>